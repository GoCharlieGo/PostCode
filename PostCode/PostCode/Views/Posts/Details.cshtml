@model PostCode.Models.Post

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div>
    <h2>@Html.DisplayFor(model => model.Name)</h2>
    <div class="col-md-3 col-lg-offset-9">
        <a href='@Url.Action("Edit", "Posts", new { id = Model.Id })'>
            <input type='button' value='Edit' class="btn btn-default" />
        </a>
        <a href='@Url.Action("Delete", "Posts", new { id = Model.Id })'>
            <input type='button' value='Delete' class="btn btn-default" />
        </a>
    </div>
    <hr/>
    <div hidden="" id="PostId">@Model.Id</div>
    <div class="form-horizontal">
        <div class="form-group">
            <div class="col-md-1" style="padding-top: 1%">
                @Html.LabelFor(model => model.Content, htmlAttributes: new { @class = "control-label col-md-1" })
            </div>
            <div class="col-md-10" style="padding-top: 1%">
                <textarea name="Content" id="Content" style="max-width: 100%;">@Html.DisplayFor(model => model.Content)</textarea>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-1" style="padding-top: 3%">
                @Html.LabelFor(model => model.Code, htmlAttributes: new { @class = "control-label col-md-1" })
            </div>
            <div class="col-md-10" style="padding-top: 3%">
                <pre><code>@Html.DisplayFor(model => model.Code)</code></pre>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-10" style="padding-left: 74%; width: 100%; padding-bottom: 5px">
                Created by @Html.DisplayFor(model => model.User.Email)
            </div>
            <div class="col-md-10" style="padding-left: 78%; width: 100%">
                @Html.DisplayFor(model => model.Data)
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-10 col-md-offset-2" id="commentsView"> </div>
        </div>
        @*@foreach (var item in Model.Comments)
        {*@
            <div class="form-group">
                <div class="col-md-10 col-md-offset-1">
                    <div class="panel panel-default">
                        <div class="panel-heading">Commented by </div>
                        <div class="panel-body">Content text</div>
                    </div>
                </div>
            </div>
        @*}*@
        <div class="form-group">
            <div class="col-md-10 col-md-offset-1">
                <textarea id="sendComment" style="max-width: 100%; width: 100%; resize: none; border-color: #dddddd; border-radius: 4px; padding: 15px" wrap="soft" rows="5">Comment</textarea>
            </div>
        </div>
            <div style="padding-left: 80%">
                <input id="CommentBtn" type='button' value='Comment' class="btn btn-default" />
            </div>
            <hr />
            <a href='@Url.Action("Index", "Posts", new {id = Model.Id})'>
                <input type='button' value='Back to List' class="btn btn-default" />
            </a>
        </div>
</div>
@section scripts{
    <script type="text/javascript">
        $(document).ready(function() {
            $('pre code').each(function(i, e) {
                hljs.highlightBlock(e);
            });
        });

        $(document).ready(function() {
            $('#Content').markdown({
                autofocus: false,
                hiddenButtons: "",
                initialstate: "preview",
                fullscreen: false
            }).initialstate = "preview";
            $(".md-editor").attr("class", "");
        });

        var getPostId = document.getElementById("PostId").innerHTML;
        $(document).ready(function() {
            $('#CommentBtn').on('click', function() {
                var getContent = document.getElementById("sendComment").value;
                $.ajax({
                    url: '/Posts/AddComment',
                    settings: {
                        type: 'POST'
                    },
                    type: 'POST',
                    data: {
                        'PostId': getPostId,
                        'Content': getContent
                    }
                });
        //        $.ajax({
        //            url: '/Posts/GetAllComments',
        //            type: 'POST',
        //            data: { 'postId': getPostId },
        //            success: function(data) {
        //                viewcomments(data);
        //            },
        //            error: function () {
        //                alert("HUI2");
        //            }
        //        });
            });
        });

        //function viewcomments(data) {
        //    var content = '';
        //    for (var index in Data) {
        //        if (data.hasOwnProperty(index)) {
        //            var item = data[index];
        //            var id = item["Id"];
        //            var userId = item["IdUser"];
        //            var comment = item["Content"];

        //            content += "<div class=\"form-group\">"+
        //            "<div class=\"col-md-10 col-md-offset-1\">"+
        //                "<div class=\"panel panel-default\">"+
        //                    "<div class=\"panel-heading\">Commented by"+userId+"</div>"+
        //                    "<div class=\"panel-body\">"+comment+"</div>"+
        //                "</div>"+
        //           "</div>"+
        //        "</div>";
        //        }
        //    }
        //    $('#commentsView').html(content);
        //};
    </script>
}